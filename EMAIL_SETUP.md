# ðŸ“§ Email Notifications Setup

This guide will help you set up email notifications for new leads in your Voyages Classy AI application.

## Features

- **Call Notifications**: Receive an email for EVERY incoming call with caller name, number, and AI-generated summary
- **New Lead Notifications**: Receive an email whenever a new lead is created
- **Beautiful HTML Emails**: Professional, branded email templates
- **Easy Integration**: Uses Resend for reliable email delivery
- **AI Summaries**: Each call notification includes a summary generated by ChatGPT-4o

## Setup Instructions

### 1. Install Resend

```bash
npm install resend
```

### 2. Create a Resend Account

1. Go to [resend.com](https://resend.com) and sign up for a free account
2. Navigate to **API Keys** in your Resend dashboard
3. Create a new API key and copy it

### 3. Configure Environment Variables

Add the following to your `.env.local` file:

```env
# Resend API Key
RESEND_API_KEY=re_your_api_key_here

# Email sender address (must be verified with Resend)
EMAIL_FROM=notifications@yourdomain.com

# Your app URL (for email links)
NEXT_PUBLIC_APP_URL=https://yourdomain.com
```

### 4. Verify Your Domain (Recommended)

For production use, you should verify your domain with Resend:

1. Go to **Domains** in your Resend dashboard
2. Click **Add Domain**
3. Follow the instructions to add DNS records
4. Use your verified domain in the `EMAIL_FROM` variable

**For testing**, you can use Resend's test email:
```env
EMAIL_FROM=onboarding@resend.dev
```

### 5. Configure Company Email in Settings

1. Log into your dashboard
2. Go to **Settings**
3. Update the **Contact Email** field with the email address where you want to receive notifications (e.g., `INFO@CLASSYTRAVEL.CA`)
4. Save changes

**This email address will receive:**
- A notification for EVERY incoming call with name, number, and AI summary
- A notification when a new lead is created

## How It Works

### Call Notifications (Every Call)

When ANY call is received through the ElevenLabs webhook:

1. The system processes the call and generates an AI summary using ChatGPT-4o
2. It checks if `RESEND_API_KEY` is configured
3. If configured, it fetches the company email from settings
4. It generates a beautiful HTML email with:
   - Caller name
   - Phone number
   - AI-generated summary (from ChatGPT-4o)
   - Call duration
   - Link to view call details
5. The email is sent to the company contact email
6. If email sending fails, the webhook still succeeds (email is not critical)

### New Lead Notifications

When a NEW lead calls for the first time, they receive BOTH:
- The call notification email (described above)
- A separate new lead notification email

## Email Content

### Call Notification Email (Sent for EVERY call)
- Caller name
- Phone number
- AI-generated summary (by ChatGPT-4o)
- Call duration
- Badge indicating if it's a new lead
- Direct link to view the call in your dashboard

### New Lead Email (Sent only for first-time callers)
- Lead name
- Phone number
- Email address (if provided)
- Destination (if provided)
- Current status
- Direct link to view the lead in your dashboard

## Troubleshooting

### Emails Not Sending

1. **Check API Key**: Verify `RESEND_API_KEY` is set correctly in `.env.local`
2. **Check Sender Email**: Make sure `EMAIL_FROM` uses a verified domain
3. **Check Company Settings**: Ensure the contact email is set in your dashboard settings
4. **Check Logs**: Look for email-related errors in your server logs

### Testing Email Notifications

You can test email notifications without waiting for a real call:

1. Use Resend's test mode with `onboarding@resend.dev`
2. Create a test lead manually through the API or webhook
3. Check your company email for the notification

## Cost

Resend offers a **generous free tier**:
- 100 emails/day
- 3,000 emails/month
- Perfect for most small to medium businesses

## Alternative Email Providers

If you prefer a different provider, you can modify `lib/email.ts`:

- **SendGrid**
- **Mailgun**
- **AWS SES**
- **Postmark**

Simply update the `sendEmail` function to use your preferred provider's API.

## Support

If you need help setting up email notifications, please check:
- [Resend Documentation](https://resend.com/docs)
- Your server logs for error messages
- The `lib/email.ts` file for implementation details

